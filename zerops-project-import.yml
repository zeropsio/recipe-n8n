#zeropsPreprocessor=on
project:
  name: recipe-n8n

services:
  - hostname: valkey
    priority: 10
    type: valkey@7.2
    mode: NON_HA

  - hostname: db
    priority: 10
    type: postgresql@17
    mode: NON_HA

  - hostname: mailpit
    type: alpine@3.21
    buildFromGit: https://github.com/zeropsio/recipe-mailpit
    enableSubdomainAccess: true

  - hostname: main
    type: nodejs@22
    buildFromGit: https://github.com/zeropsio/recipe-n8n@matej
    enableSubdomainAccess: true
    envSecrets:
      ENCRYPTION_KEY: <@generateRandomString(<32>) | toHex>
    maxContainers: 1

  - hostname: workers
    type: nodejs@22
    buildFromGit: https://github.com/zeropsio/recipe-n8n@matej
    minContainers: 3
    maxContainers: 3
